<section class="container">
  <header class="page-header">
    <h2>Firewalls</h2>
    <button mat-raised-button color="primary" class="new-btn" (click)="openCreate()">+ Nouveau</button>
  </header>

  <mat-form-field appearance="outline" class="w-100 mb-12">
    <mat-label>Rechercher par nom…</mat-label>
    <input matInput (input)="onSearch($any($event.target)?.value ?? '')" />
  </mat-form-field>

  <div *ngIf="loading()" class="muted">Chargement…</div>
  <div *ngIf="error()" class="error">{{ error() }}</div>

  <div class="mat-elevation-z2 table-wrap" *ngIf="(search().trim() ? filtered().length : items().length); else empty">
    <table mat-table [dataSource]="search().trim() ? paged() : items()" class="full-width compact-table">
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Nom</th>
        <td mat-cell *matCellDef="let fw">
          <a [routerLink]="['/firewalls', fw.id]" class="link">{{ fw.name }}</a>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="actions-header">Actions</th>
        <td mat-cell *matCellDef="let fw" class="actions-col">
          <div class="actions">
            <button mat-button (click)="openEdit(fw)">
              <mat-icon>edit</mat-icon><span class="label">Modifier</span>
            </button>
            <button mat-button color="warn" (click)="askDelete(fw)">
              <mat-icon>delete</mat-icon><span class="label">Supprimer</span>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [length]="search().trim() ? filtered().length : total()"
      [pageIndex]="search().trim() ? (localPage() - 1) : (page() - 1)"
      [pageSize]="search().trim() ? localPageSize() : pageSize()"
      [pageSizeOptions]="[10]"
      (page)="onPage($event)">
    </mat-paginator>
  </div>

  <ng-template #empty>
    <p class="muted">Aucun firewall pour l’instant.</p>
  </ng-template>

  <!-- CREATE -->
  <ng-template #createTpl>
    <h2 mat-dialog-title>Créer un Firewall</h2>
    <form [formGroup]="createForm" mat-dialog-content class="form">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Nom *</mat-label>
        <input matInput formControlName="name" />
        <mat-error *ngIf="createForm.controls.name.touched && createForm.controls.name.invalid">
          Nom requis (min 2 caractères)
        </mat-error>
      </mat-form-field>
    </form>
    <div mat-dialog-actions align="end">
      <button mat-button mat-dialog-close>Annuler</button>
      <button mat-raised-button color="primary" [disabled]="createForm.invalid" (click)="submitCreate()">
        Créer
      </button>
    </div>
  </ng-template>

  <!-- EDIT -->
  <ng-template #editTpl>
    <h2 mat-dialog-title>Modifier « {{ editName() }} »</h2>
    <form [formGroup]="editForm" mat-dialog-content class="form">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Nom *</mat-label>
        <input matInput formControlName="name" />
        <mat-error *ngIf="editForm.controls.name.touched && editForm.controls.name.invalid">
          Nom requis (min 2 caractères)
        </mat-error>
      </mat-form-field>
    </form>
    <div mat-dialog-actions align="end">
      <button mat-button mat-dialog-close>Annuler</button>
      <button mat-raised-button color="primary" [disabled]="editForm.invalid" (click)="submitEdit()">
        Enregistrer
      </button>
    </div>
  </ng-template>
</section>
